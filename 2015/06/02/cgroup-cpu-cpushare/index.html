
<!DOCTYPE html>
<html lang="ja">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="harasou.jp">
    <title>cgroup の cpu.shares を検証した - harasou.jp</title>
    <meta name="author" content="harasou">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="cgroup には複数のサブシステム（controller）があるが、その中の cpu.shares について検証してみた。">
<meta property="og:type" content="blog">
<meta property="og:title" content="cgroup の cpu.shares を検証した">
<meta property="og:url" content="https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/index.html">
<meta property="og:site_name" content="harasou.jp">
<meta property="og:description" content="cgroup には複数のサブシステム（controller）があるが、その中の cpu.shares について検証してみた。">
<meta property="og:image" content="https://harasou.jp/cgroup.png">
<meta property="og:image" content="https://harasou.jp/cgroup_test1.png">
<meta property="og:image" content="https://harasou.jp/cgroup_test2.png">
<meta property="og:image" content="https://harasou.jp/cgroup_test3.png">
<meta property="og:image" content="https://harasou.jp/cgroup_test4.png">
<meta property="og:image" content="https://harasou.jp/cgroup_test5.png">
<meta property="og:image" content="https://harasou.jp/cgroup_test6.png">
<meta property="og:image" content="https://harasou.jp/cgroup_test7.png">
<meta property="og:updated_time" content="2016-11-12T14:32:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="cgroup の cpu.shares を検証した">
<meta name="twitter:description" content="cgroup には複数のサブシステム（controller）があるが、その中の cpu.shares について検証してみた。">
<meta name="twitter:image" content="https://harasou.jp/cgroup.png">
<meta name="twitter:creator" content="@harasou5">
    
    
        
    
    
        <meta property="og:image" content="https://www.gravatar.com/avatar/ae9a272994f212bdbddfa0f4367b0f3d?s=640"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css">
    <link rel="stylesheet" href="/assets/style.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-62541096-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">harasou.jp</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="https://www.gravatar.com/avatar/ae9a272994f212bdbddfa0f4367b0f3d?s=90"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->


    

<nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/ae9a272994f212bdbddfa0f4367b0f3d?s=110"/>
            </a>
            <span class="sidebar-profile-name">harasou</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">ホーム</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">カテゴリー</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">タグ</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">アーカイブ</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">プロフィール</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/harasou" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            cgroup の cpu.shares を検証した
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" datetime="2015-06-02T04:09:33+09:00">
	
		    2015/06/02
    	
    </time>
    
</div>

</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>cgroup には複数のサブシステム（controller）があるが、その中の <code>cpu.shares</code> について検証してみた。</p>
<a id="more"></a>
<h2 id="cpu-shares-とは"><a href="#cpu-shares-とは" class="headerlink" title="cpu.shares とは"></a>cpu.shares とは</h2><p>cpu.shares を設定すると、タスクが使用できる CPU 時間の<code>割合</code>を変更することができる。</p>
<p>具体的に言うと、<code>A</code> <code>B</code>２つのグループを作り、cpu.shares をそれぞれ<code>1024</code> <code>2048</code>とした場合、B のグループにいるプロセスが、A のグループにいるプロセスより 2倍 CPU を使えるようになる。以下、実行例。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mkdir /cgroup/&#123;A,B&#125;</span></div><div class="line"><span class="comment"># echo 1024 &gt; /cgroup/A/cpu.shares</span></div><div class="line"><span class="comment"># echo 2048 &gt; /cgroup/B/cpu.shares</span></div><div class="line"><span class="comment"># sh -c "while : ; do : ; done" &amp; echo $! &gt; /cgroup/A/tasks</span></div><div class="line">[1] 2835</div><div class="line"><span class="comment"># sh -c "while : ; do : ; done" &amp; echo $! &gt; /cgroup/B/tasks</span></div><div class="line">[2] 2836</div><div class="line"><span class="comment"># ps uf</span></div><div class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</div><div class="line">root      2816  0.0  0.5 175140  2656 pts/2    S    21:44   0:00 sudo <span class="_">-s</span></div><div class="line">root      2817  0.0  0.3 108300  1908 pts/2    S+   21:44   0:00  \_ /bin/bash</div><div class="line">root      2835 34.9  0.2 106056  1268 pts/2    R    21:47   0:56      \_ sh -c <span class="keyword">while</span> : ; <span class="keyword">do</span> : ; <span class="keyword">done</span></div><div class="line">root      2836 66.1  0.2 106056  1268 pts/2    R    21:47   1:43      \_ sh -c <span class="keyword">while</span> : ; <span class="keyword">do</span> : ; <span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>グループ B に登録した PID:2836 のプロセスが、グループ A に登録した PID:2835 の 2倍 CPU を使用している。</p>
<h2 id="今回の疑問点"><a href="#今回の疑問点" class="headerlink" title="今回の疑問点"></a>今回の疑問点</h2><p>これだけなら、わかりやすいが、以下の点が不明だったので実際に検証してみた。</p>
<ul>
<li>グループ内に複数プロセスがいる場合どのように CPU が割り振られるのか</li>
<li>ルートグループに属するプロセスの CPU の割り振りはどうなるか</li>
</ul>
<h2 id="環境"><a href="#環境" class="headerlink" title="環境"></a>環境</h2><ul>
<li>マシン: Vagrant(CPU コア1)</li>
<li><p>OS:</p>
<ul>
<li>CentOS6.6 (2.6.32-504.16.2.el6.x86_64)</li>
<li>CentOS7.1 (3.10.0-229.el7.x86_64)</li>
</ul>
</li>
<li><p>今回検証したグループ構成</p>
<p>  <img src="cgroup.png" alt=""></p>
<ul>
<li>CPU のルートグループ配下に <code>test</code> グループを作成する</li>
<li>test グループ配下に、<code>A</code> <code>B</code> <code>C</code> グループを作成する</li>
<li>作成した全てのグループの<code>cpu.shares</code> は、全て <code>1024</code> と同じにする</li>
</ul>
</li>
<li><p>環境構築手順(CentOS6.6)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost vagrant]# mkdir /cgroup</div><div class="line">[root@localhost vagrant]# mount -t cgroup -o cpu cgroup /cgroup/</div><div class="line">[root@localhost vagrant]# mkdir -p /cgroup/test/&#123;A,B,C&#125;</div><div class="line">[root@localhost vagrant]# head /cgroup/&#123;,test/&#123;,&#123;A,B,C&#125;/&#125;&#125;cpu.shares</div><div class="line">==&gt; /cgroup/cpu.shares &lt;==</div><div class="line">1024</div><div class="line"></div><div class="line">==&gt; /cgroup/test/cpu.shares &lt;==</div><div class="line">1024</div><div class="line"></div><div class="line">==&gt; /cgroup/test/A/cpu.shares &lt;==</div><div class="line">1024</div><div class="line"></div><div class="line">==&gt; /cgroup/test/B/cpu.shares &lt;==</div><div class="line">1024</div><div class="line"></div><div class="line">==&gt; /cgroup/test/C/cpu.shares &lt;==</div><div class="line">1024</div></pre></td></tr></table></figure>
</li>
<li><p>CPU を使用するシェルスクリプト</p>
  <figure class="highlight sh"><figcaption><span>loop.sh</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">CGROUP=$(mount|grep -w cpu|awk <span class="string">'&#123;print $3&#125;'</span>)</div><div class="line"><span class="built_in">echo</span> $$ &gt; <span class="variable">$CGROUP</span>/tasks || <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">while</span> : ; <span class="keyword">do</span> : ; <span class="keyword">done</span></div></pre></td></tr></table></figure>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">loop.sh &amp;            <span class="comment"># ルートグループに自身の PID を登録し無限ループ</span></div><div class="line">loop_test.sh &amp;       <span class="comment"># test グループに自身の PID を登録し無限ループ</span></div><div class="line">loop_test_A.sh &amp;     <span class="comment"># test/A グループに自身の PID を登録し無限ループ</span></div><div class="line">loop_test_B.sh &amp;     <span class="comment"># test/B グループに自身の PID を登録し無限ループ</span></div><div class="line">loop_test_C.sh &amp;     <span class="comment"># test/C グループに自身の PID を登録し無限ループ</span></div></pre></td></tr></table></figure>
<p>  自分自身の PID をスクリプト名にあったグループに登録し、無限ループを行うシェルスクリプト。</p>
</li>
</ul>
<h2 id="検証１"><a href="#検証１" class="headerlink" title="検証１"></a>検証１</h2><p><code>A</code> グループに、無限ループするプロセスを一つ登録した場合の CPU 利用状況。</p>
<p><img src="cgroup_test1.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 結果</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 1858 root      20   0  103m 1344 1160 R 99.8  0.3   0:11.30 loop_test_A.sh</div></pre></td></tr></table></figure>
<ul>
<li><code>ルート</code> -&gt; <code>test</code> -&gt; <code>A</code> と最下層のグループに登録されているが、CPU は 100% 利用できる。</li>
</ul>
<h2 id="検証２"><a href="#検証２" class="headerlink" title="検証２"></a>検証２</h2><p><code>A</code> <code>B</code> <code>C</code>の各グループに、無限ループをするプロセスを一つづつ登録した場合の CPU 使用状況。</p>
<p><img src="cgroup_test2.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 結果</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 1858 root      20   0  103m 1344 1160 R 33.3  0.3   0:51.82 loop_test_A.sh</div><div class="line"> 1863 root      20   0  103m 1348 1160 R 33.3  0.3   0:25.00 loop_test_B.sh</div><div class="line"> 1868 root      20   0  103m 1344 1160 R 33.3  0.3   0:23.39 loop_test_C.sh</div></pre></td></tr></table></figure>
<ul>
<li>各グループの cpu.shares の値は同じなので、均等に CPU を 1/3 (33.3%)づつ使用している。</li>
</ul>
<h2 id="検証３"><a href="#検証３" class="headerlink" title="検証３"></a>検証３</h2><p>検証２に加え、<code>C</code> グループに、もう一つプロセスを登録した場合の CPU の利用状況。</p>
<p><img src="cgroup_test3.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 結果</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 1858 root      20   0  103m 1344 1160 R 33.6  0.3   1:04.14 loop_test_A.sh</div><div class="line"> 1863 root      20   0  103m 1348 1160 R 33.3  0.3   0:37.32 loop_test_B.sh</div><div class="line"> 1868 root      20   0  103m 1344 1160 R 16.6  0.3   0:34.81 loop_test_C.sh</div><div class="line"> 1882 root      20   0  103m 1348 1160 R 16.6  0.3   0:00.88 loop_test_C.sh</div></pre></td></tr></table></figure>
<ul>
<li>グループ A, B に割り当てられている CPU 時間は変わらない</li>
<li>検証２でグループ C に割り当てられていた CPU 時間(33.3%)は、２つのプロセス（2570,2573）に分配されている</li>
</ul>
<h2 id="検証４"><a href="#検証４" class="headerlink" title="検証４"></a>検証４</h2><p>検証３に加え、<code>test</code>グループに無限ループするスクリプトを一つ、追加登録した場合の CPU 利用状況。</p>
<p><img src="cgroup_test4.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 結果</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 1887 root      20   0  103m 1348 1160 R 24.9  0.3   0:05.77 loop_test.sh</div><div class="line"> 1858 root      20   0  103m 1344 1160 R 24.9  0.3   1:15.43 loop_test_A.sh</div><div class="line"> 1863 root      20   0  103m 1348 1160 R 24.9  0.3   0:48.61 loop_test_B.sh</div><div class="line"> 1868 root      20   0  103m 1344 1160 R 12.6  0.3   0:40.46 loop_test_C.sh</div><div class="line"> 1882 root      20   0  103m 1348 1160 R 12.3  0.3   0:06.53 loop_test_C.sh</div></pre></td></tr></table></figure>
<ul>
<li>CPU 時間は、test グループの１つのプロセス <code>1887</code> とグループ<code>A</code> <code>B</code> <code>C</code> で、４等分(25%)されている</li>
<li>C グループ 配下のプロセスは、４等分された CPU時間(25%) を分配して利用している</li>
</ul>
<h2 id="検証５"><a href="#検証５" class="headerlink" title="検証５"></a>検証５</h2><p>検証４に加え、さらに<code>test</code>グループに無限ループするスクリプトを一つ、追加登録した場合の CPU 利用状況。</p>
<p><img src="cgroup_test5.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 結果</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 1892 root      20   0  103m 1348 1160 R 20.3  0.3   0:01.57 loop_test.sh</div><div class="line"> 1887 root      20   0  103m 1348 1160 R 20.0  0.3   0:14.80 loop_test.sh</div><div class="line"> 1863 root      20   0  103m 1348 1160 R 20.0  0.3   0:57.63 loop_test_B.sh</div><div class="line"> 1858 root      20   0  103m 1344 1160 R 20.0  0.3   1:24.45 loop_test_A.sh</div><div class="line"> 1868 root      20   0  103m 1344 1160 R 10.0  0.3   0:44.97 loop_test_C.sh</div><div class="line"> 1882 root      20   0  103m 1348 1160 R 10.0  0.3   0:11.05 loop_test_C.sh</div></pre></td></tr></table></figure>
<ul>
<li>CPU 時間は、test グループの２つのプロセス <code>1892</code> <code>1887</code> とグループ<code>A</code> <code>B</code> <code>C</code> で、５等分(20%)されている</li>
<li>test グループの２つのプロセス <code>1892</code> <code>1887</code> は、それぞれ５等分された CPU時間(20%) を利用できる</li>
</ul>
<h2 id="検証６"><a href="#検証６" class="headerlink" title="検証６"></a>検証６</h2><p>検証３に加え、ルートグループに無限ループするスクリプトを一つ、追加登録した場合の CPU 利用状況。</p>
<p><img src="cgroup_test6.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 結果</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 1898 root      20   0  103m 1344 1160 R 50.2  0.3   0:03.83 loop.sh</div><div class="line"> 1858 root      20   0  103m 1344 1160 R 16.6  0.3   1:32.35 loop_test_A.sh</div><div class="line"> 1863 root      20   0  103m 1348 1160 R 16.6  0.3   1:05.53 loop_test_B.sh</div><div class="line"> 1868 root      20   0  103m 1344 1160 R  8.3  0.3   0:48.92 loop_test_C.sh</div><div class="line"> 1882 root      20   0  103m 1348 1160 R  8.3  0.3   0:14.99 loop_test_C.sh</div></pre></td></tr></table></figure>
<ul>
<li>CPU 時間は、ルートグループの１つのプロセス <code>1898</code> と <code>test グループ</code> で、２等分(50%)されている</li>
<li>test グループ 配下のプロセスは、２等分された CPU時間(50%) を分配して利用している</li>
</ul>
<h2 id="検証７"><a href="#検証７" class="headerlink" title="検証７"></a>検証７</h2><p>検証６に加え、さらにルートグループに無限ループするスクリプトを一つ、追加登録した場合の CPU 利用状況。</p>
<p><img src="cgroup_test7.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 結果</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 1898 root      20   0  103m 1344 1160 R 33.5  0.3   0:10.72 loop.sh</div><div class="line"> 1903 root      20   0  103m 1348 1160 R 33.2  0.3   0:01.53 loop.sh</div><div class="line"> 1858 root      20   0  103m 1344 1160 R 11.3  0.3   1:34.65 loop_test_A.sh</div><div class="line"> 1863 root      20   0  103m 1348 1160 R 11.0  0.3   1:07.82 loop_test_B.sh</div><div class="line"> 1882 root      20   0  103m 1348 1160 R  5.6  0.3   0:16.14 loop_test_C.sh</div><div class="line"> 1868 root      20   0  103m 1344 1160 R  5.3  0.3   0:50.06 loop_test_C.sh</div></pre></td></tr></table></figure>
<ul>
<li>CPU 時間は、ルートグループの２つのプロセス<code>1898</code> <code>1903</code> と <code>test グループ</code> で、３等分(33%)されている</li>
<li>ルートグループの２つのプロセス <code>1898</code> <code>1903</code> は、それぞれ３等分された CPU時間(33%) を利用できる</li>
<li>test グループ 配下のプロセスは、３等分された CPU時間(33%) を分配して利用している</li>
</ul>
<h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>検証７の結果を見れば、cpu.shares の振る舞いがだいたいわかる。</p>
<p>test グループ配下のプロセスが利用できる CPU時間は、ルートグループに属するプロセス数や CPU 利用状況によってかわるので、リソース設計が難しい。</p>
<p>このため、test グループの CPU時間を担保したい場合は、以下のような感じで、一旦ルートグループ配下の全プロセスを別のサブグループ配下に移動してあげればよさそう。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /cgroup/root</div><div class="line">cat /cgroup/tasks &gt; /cgrou/root/tasks</div></pre></td></tr></table></figure>

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">タグ</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/cgroup/">cgroup</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/06/07/MySQL-trigger/"  data-tooltip="MySQL のトリガで mruby を実行する">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">前</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/05/25/CentOS-lxc-rpm/" data-tooltip="CentOS 用に LXC の rpm を作成する">
                
                    <span class="hide-xs hide-sm text-small icon-mr">次</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs pocket-btn-icon">
            <a class="post-action-btn btn btn--default pocket-btn-icon-link" target="new" href="http://getpocket.com/edit?url=https%3A%2F%2Fharasou.jp%2F2015%2F06%2F02%2Fcgroup-cpu-cpushare%2F&title=cgroup の cpu.shares を検証した">
                 <i class="icon-pocket"></i>
            </a>
        </li>
        <li class="post-action hide-xs hatebu-btn-icon">
            <a class="post-action-btn btn btn--default hatebu-btn-icon-link" target="new" href="http://b.hatena.ne.jp/add?mode=confirm&url=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                 <i class="icon-hatebu hatena-bookmark-button"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/share?text=cgroup%20%E3%81%AE%20cpu.shares%20%E3%82%92%E6%A4%9C%E8%A8%BC%E3%81%97%E3%81%9F&via=harasou5&url=https%3A%2F%2Fharasou.jp%2F2015%2F06%2F02%2Fcgroup-cpu-cpushare%2F">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
    </ul>
</div>


        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 harasou. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/06/07/MySQL-trigger/"  data-tooltip="MySQL のトリガで mruby を実行する">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">前</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/05/25/CentOS-lxc-rpm/" data-tooltip="CentOS 用に LXC の rpm を作成する">
                
                    <span class="hide-xs hide-sm text-small icon-mr">次</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs pocket-btn-icon">
            <a class="post-action-btn btn btn--default pocket-btn-icon-link" target="new" href="http://getpocket.com/edit?url=https%3A%2F%2Fharasou.jp%2F2015%2F06%2F02%2Fcgroup-cpu-cpushare%2F&title=cgroup の cpu.shares を検証した">
                 <i class="icon-pocket"></i>
            </a>
        </li>
        <li class="post-action hide-xs hatebu-btn-icon">
            <a class="post-action-btn btn btn--default hatebu-btn-icon-link" target="new" href="http://b.hatena.ne.jp/add?mode=confirm&url=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                 <i class="icon-hatebu hatena-bookmark-button"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/share?text=cgroup%20%E3%81%AE%20cpu.shares%20%E3%82%92%E6%A4%9C%E8%A8%BC%E3%81%97%E3%81%9F&via=harasou5&url=https%3A%2F%2Fharasou.jp%2F2015%2F06%2F02%2Fcgroup-cpu-cpushare%2F">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="3">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                <i class="fa fa-google-plus"></i><span class="">Google Plusで共有</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                <i class="fa fa-facebook-official"></i><span>Facebookで共有</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/">
                <i class="fa fa-twitter"></i><span>Twitterで共有</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        


    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="https://www.gravatar.com/avatar/ae9a272994f212bdbddfa0f4367b0f3d?s=110"/>
        
            <h4 id="about-card-name">harasou</h4>
        
            <h5 id="about-card-bio"><p>めくじらを立てない</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Infra Engineer</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Fukuoka Japan
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'https://harasou.jp/2015/06/02/cgroup-cpu-cpushare/';
                 
                    this.page.identifier = '2015/06/02/cgroup-cpu-cpushare/';
                                  
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'harasougithubio';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    



</html>
